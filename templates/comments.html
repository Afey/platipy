{% extends 'base.html' %}
{% block body %}

    {# ---- favorites section ---- #}

    <div>
        <div style="float: left">
            {% if section %}
                {{section.num_favorites}}
            {% else %}
                0
            {% endif %}
        </div>
        {% if favorite %}
            <form method="POST" action="/favorite">
                <input type="hidden" name="html_section" value="{{html_section}}"></input>
                <input type="hidden" name="favorited_status" value="true"></input>
                <button 
                    type="submit" 
                    class="btn btn-default btn-xs btn-link" 
                    id="yellow_star" 
                    style="float:left">
                    <span class="glyphicon glyphicon-star"></span>
                </button> 
            </form>
        {% else %}
            <form method="POST" action="/favorite">
                <input type="hidden" name="html_section" value="{{html_section}}"></input>
                <input type="hidden" name="favorited_status" value="false"></input>
                <button 
                    type="submit" 
                    class="btn btn-default btn-xs btn-link" 
                    id="white_star" 
                    style="float: left">
                    <span class="glyphicon glyphicon-star-empty"></span>
                </button>
            </form>
        {% endif %}
    </div>
    <br />

    {# ---- comments section ---- #}

    <div class="row">
        <div class="col-sm-12">

            {% if github_name == None %}
                <form role="form">
                    <fieldset disabled>
                        <div class="form-group">
                            <textarea class="form-control" rows="3" cols="300"></textarea>
                        </div>
                    </fieldset>
                </form>
                <form 
                    method="GET"
                    action="/authenticate"
                    target="_blank">
                    <input type="hidden" name="html_section" value="{{html_section}}"></input>
                    <button type="submit" class="btn btn-default btn-sm">
                        <img src="/static/images/octocat.png"></img>
                        Sign in to post
                    </button>
                </form>

            {% else %}
                <form method="POST" style="padding-left: 10px;" role="form">
                    <div class="form-group">
                        <textarea name="comment" class="form-control" rows="3" cols="300"></textarea>
                    </div>
                    <div class="form-group">
                        <button type="submit" class="btn btn-primary btn-sm">
                            Post
                        </button>
                        <span class="text-muted"> Logged in to github as {{github_name}} </span>
                    </div>
                </form>
                <form action="/log_out">
                    <input type="hidden" name="html_section" value="{{html_section}}"/>
                    <button type="submit" class="btn btn-default btn-sm">
                        Log out
                    </button>
                </form>
                
            {% endif %}
        </div>
    </div>

    <div>
        {% for comment in section.comment %}
            <div class="row">
                <div class="col-sm-1">
                    <form method="POST" action="/vote">
                        <input type="hidden" name="comment_id" value="{{comment.id}}"/>
                        <input type="hidden" name="html_section" value="{{html_section}}"/>
                        <button
                            type="submit"
                            class="btn btn-default btn-xs btn-block btn-link"
                            name="vote"
                            value="up">
                            <span class="glyphicon glyphicon-circle-arrow-up"></span>
                        </button>
                        <div class="text-center">{{comment.rating}}</div>
                        <button 
                            type="submit" 
                            class="btn btn-default btn-xs btn-block btn-link" 
                            name="vote" 
                            value="down">
                            <span class="glyphicon glyphicon-circle-arrow-down"></span>
                        </button>
                    </form>
                </div>
                <div class="col-sm-11 comment-box">
                    <strong class="text-muted">
                        {{comment.created_at|datefilter}} by 
                        <a href="http://github.com/{{comment.user.github_name}}" target="_blank">
                            {{comment.user.github_name}}
                        </a>
                    </strong>
                    {% if "[code]" in comment.comment %}
                        {{comment.comment|codefilter|safe}}
                    {% else %}
                        <p>{{comment.comment}}</p>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>

{% endblock %}